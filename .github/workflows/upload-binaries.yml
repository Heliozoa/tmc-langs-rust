name: Upload CLI binaries

on: push

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
        with:
          project_id: tmc-langs
          service_account_key: ${{ secrets.GCP_SA_KEY }}
      - name: Build
        run: |
          cargo build -p tmc-langs-cli --release --verbose --target x86_64-pc-windows-msvc
          mv target/x86_64-pc-windows-msvc/release/tmc-langs-cli.exe tmc-langs-cli-x86_64-pc-windows-msvc.exe
          $env:python_version=$(python -c 'import sys; print(\".\".join(map(str, sys.version_info[:3])))')
          $env:CLOUDSDK_PYTHON="C:\hostedtoolcache\windows\Python\$env:python_version\x64\python"
          gsutil cp tmc-langs-cli-x86_64-pc-windows-msvc.exe gs://4c5fa153-643f-4d23-84c3-0b70e3bea571
